{"version":3,"file":"companyInformationService.js","sourceRoot":"","sources":["../../../src/backend/services/companyInformationService.ts"],"names":[],"mappings":";AAAA;;;;;GAKG;;;;;AASH,0DAmDC;AA1DD,oDAA4B;AAG5B;;;GAGG;AACI,KAAK,UAAU,uBAAuB,CAAC,KAAa;IACzD,IAAI,CAAC;QACH,MAAM,MAAM,GAAG,IAAI,gBAAM,CAAC;YACxB,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,cAAc;SACnC,CAAC,CAAC;QAEH,8DAA8D;QAC9D,MAAM,QAAQ,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,YAAY,IAAI,cAAc;YACjD,QAAQ,EAAE;gBACR;oBACE,IAAI,EAAE,QAAQ;oBACd,OAAO,EAAE;;;;;;;;sJAQmI;iBAC7I;gBACD;oBACE,IAAI,EAAE,MAAM;oBACZ,OAAO,EAAE,KAAK;iBACf;aACF;YACD,WAAW,EAAE,GAAG,EAAE,6CAA6C;YAC/D,eAAe,EAAE,EAAE,IAAI,EAAE,aAAa,EAAE;SACzC,CAAC,CAAC;QAEH,4BAA4B;QAC5B,MAAM,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,OAAO,IAAI,yFAAyF,CAAC;QAEnJ,IAAI,CAAC;YACH,MAAM,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAuB,CAAC;YAC/D,OAAO,YAAY,CAAC;QACtB,CAAC;QAAC,OAAO,UAAU,EAAE,CAAC;YACpB,OAAO,CAAC,KAAK,CAAC,qDAAqD,EAAE,UAAU,CAAC,CAAC;YACjF,OAAO;gBACL,MAAM,EAAE,+DAA+D;gBACvE,UAAU,EAAE,KAAK;aAClB,CAAC;QACJ,CAAC;IACH,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,CAAC,KAAK,CAAC,qCAAqC,EAAE,KAAK,CAAC,CAAC;QAC5D,OAAO;YACL,MAAM,EAAE,sFAAsF;YAC9F,UAAU,EAAE,KAAK;SAClB,CAAC;IACJ,CAAC;AACH,CAAC","sourcesContent":["/**\n * Company Information Service\n * \n * This service provides company information by leveraging OpenAI's knowledge\n * without requiring a separate database or manual data entry.\n */\n\nimport OpenAI from 'openai';\nimport type { CompanyQueryResult } from '../functions/_shared/companyKnowledgeTypes';\n\n/**\n * Uses OpenAI to generate accurate responses to company information queries\n * This approach leverages the model's knowledge without maintaining a separate database\n */\nexport async function queryCompanyInformation(query: string): Promise<CompanyQueryResult> {\n  try {\n    const openai = new OpenAI({\n      apiKey: process.env.OPENAI_API_KEY,\n    });\n\n    // Create a specialized prompt for company information queries\n    const response = await openai.chat.completions.create({\n      model: process.env.OPENAI_MODEL || \"gpt-4.1-mini\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a corporate information assistant specializing in answering questions about companies. \n          \nProvide accurate, concise answers about company executives, leadership, structure, history, products, and industry information.\n\nFormat your response in JSON with two fields:\n1. \"answer\" - Your factual response formatted as markdown\n2. \"confidence\" - One of: \"high\", \"medium\", or \"low\" based on how confident you are in the information\n\nIf the question asks about very recent information (within the last few months), mention that your knowledge may not include the most recent changes.`\n        },\n        {\n          role: \"user\",\n          content: query\n        }\n      ],\n      temperature: 0.1, // Keep temperature low for factual responses\n      response_format: { type: \"json_object\" }\n    });\n\n    // Extract the JSON response\n    const content = response.choices[0]?.message?.content || '{\"answer\": \"I could not retrieve information about this company.\", \"confidence\": \"low\"}';\n    \n    try {\n      const parsedResult = JSON.parse(content) as CompanyQueryResult;\n      return parsedResult;\n    } catch (parseError) {\n      console.error(\"Failed to parse company information result as JSON:\", parseError);\n      return {\n        answer: \"There was an error processing information about this company.\",\n        confidence: \"low\"\n      };\n    }\n  } catch (error) {\n    console.error(\"Error querying company information:\", error);\n    return {\n      answer: \"I encountered an error while retrieving company information. Please try again later.\",\n      confidence: \"low\"\n    };\n  }\n}"]}