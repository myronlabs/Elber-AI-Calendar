{"version":3,"file":"intelligentContactTool.js","sourceRoot":"","sources":["../../../../src/backend/functions/_shared/intelligentContactTool.ts"],"names":[],"mappings":"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","sourcesContent":["// Intelligent Contact Management Tool - Following OpenAI Best Practices\n// Single tool that handles complete contact workflows intelligently\n\nimport type { OpenAI } from 'openai';\n\n/**\n * Single, intelligent contact management tool following OpenAI best practices:\n * 1. Combines functions that would be called in sequence\n * 2. Handles user intent naturally without complex parameters\n * 3. Never requires follow-up calls for normal operations\n * 4. Passes the \"intern test\" - intuitive and obvious to use\n */\nexport const intelligentContactTool: OpenAI.Chat.Completions.ChatCompletionTool = {\n  type: \"function\",\n  function: {\n    name: \"manage_contact\",\n    description: `Elber's intelligent contact management that handles any contact operation in a single call.\n\n    This tool automatically:\n    - Finds contacts based on any identifier (name, email, phone, etc.)\n    - Handles duplicates intelligently based on user intent\n    - Applies updates to the right contacts without asking for clarification\n    - Creates contacts when they don't exist\n    - Confirms destructive operations appropriately\n    - Intelligently routes phone numbers to the correct field based on context and user intent\n    \n    Examples of what this handles automatically:\n    - \"update [contact name] phone to [number]\" → finds all matching contacts, updates phone on all\n    - \"add mobile phone [number] to [contact]\" → uses mobile_phone field\n    - \"add work phone [number] to [contact]\" → uses work_phone field\n    - \"add cell phone [number] to [contact]\" → uses mobile_phone field\n    - \"delete [contact name]\" → finds contact, asks for confirmation, then deletes\n    - \"create contact [first name] [last name]\" → creates new contact\n    - \"find contacts at [company]\" → searches and returns matches\n    - \"move [contact] phone to mobile\" → intelligently moves phone number to mobile field\n    - \"merge duplicate contacts [name]\" → finds duplicates and combines them intelligently\n    \n    PHONE FIELD USAGE:\n    - phone: Default/home phone number\n    - mobile_phone: Mobile/cell/cellular phone number\n    - work_phone: Work/office/business phone number\n    \n    The tool uses AI to understand user intent and route phone numbers to the correct field automatically.`,\n    strict: true,\n    parameters: {\n      type: \"object\",\n      properties: {\n        user_request: {\n          type: \"string\",\n          description: \"The complete user request in natural language. Be specific and include all details the user provided.\"\n        },\n        intended_action: {\n          type: \"string\", \n          enum: [\"search\", \"create\", \"update\", \"delete\", \"merge\"],\n          description: \"Primary action the user wants to take\"\n        },\n        search_term: {\n          type: [\"string\", \"null\"],\n          description: \"Name, email, phone, or other identifier to find contacts. Leave null for create operations.\"\n        },\n        contact_updates: {\n          type: [\"object\", \"null\"],\n          description: \"Fields to update/create. Only include fields that should be changed/set.\",\n          properties: {\n            // Personal Information\n            first_name: { type: [\"string\", \"null\"] },\n            middle_name: { type: [\"string\", \"null\"] },\n            last_name: { type: [\"string\", \"null\"] },\n            nickname: { type: [\"string\", \"null\"] },\n            \n            // Contact Information\n            email: { type: [\"string\", \"null\"] },\n            phone: { type: [\"string\", \"null\"] },\n            mobile_phone: { type: [\"string\", \"null\"] },\n            work_phone: { type: [\"string\", \"null\"] },\n            website: { type: [\"string\", \"null\"] },\n            \n            // Professional Information\n            company: { type: [\"string\", \"null\"] },\n            job_title: { type: [\"string\", \"null\"] },\n            department: { type: [\"string\", \"null\"] },\n            \n            // Address Information\n            street_address: { type: [\"string\", \"null\"] },\n            street_address_2: { type: [\"string\", \"null\"] },\n            city: { type: [\"string\", \"null\"] },\n            state_province: { type: [\"string\", \"null\"] },\n            postal_code: { type: [\"string\", \"null\"] },\n            country: { type: [\"string\", \"null\"] },\n            formatted_address: { type: [\"string\", \"null\"] },\n            \n            // Social Media\n            social_linkedin: { type: [\"string\", \"null\"] },\n            social_twitter: { type: [\"string\", \"null\"] },\n            \n            // Preferences and Metadata\n            tags: { \n              type: [\"array\", \"null\"],\n              items: { type: \"string\" },\n              description: \"Array of tags for categorization\"\n            },\n            preferred_contact_method: { type: [\"string\", \"null\"] },\n            timezone: { type: [\"string\", \"null\"] },\n            language: { type: [\"string\", \"null\"] },\n            \n            // Other Information\n            birthday: { type: [\"string\", \"null\"] },\n            notes: { type: [\"string\", \"null\"] },\n            \n            // Import tracking (for updates only)\n            import_source: { type: [\"string\", \"null\"] },\n            google_contact_id: { type: [\"string\", \"null\"] }\n          },\n          required: [\n            \"first_name\", \"middle_name\", \"last_name\", \"nickname\",\n            \"email\", \"phone\", \"mobile_phone\", \"work_phone\", \"website\",\n            \"company\", \"job_title\", \"department\",\n            \"street_address\", \"street_address_2\", \"city\", \"state_province\", \"postal_code\", \"country\", \"formatted_address\",\n            \"social_linkedin\", \"social_twitter\",\n            \"tags\", \"preferred_contact_method\", \"timezone\", \"language\",\n            \"birthday\", \"notes\",\n            \"import_source\", \"google_contact_id\"\n          ],\n          additionalProperties: false\n        },\n        confirmation_provided: {\n          type: \"boolean\",\n          description: \"Set to true if user has already confirmed a destructive action, false for initial requests\"\n        }\n      },\n      required: [\"user_request\", \"intended_action\", \"search_term\", \"contact_updates\", \"confirmation_provided\"],\n      additionalProperties: false\n    }\n  }\n};\n\nexport const intelligentContactGuidance = `## Elber's Intelligent Contact Management Guidelines\n\n**One Tool for Everything:**\nUse \\`manage_contact\\` for ALL contact operations. Elber's tool intelligently handles:\n\n1. **Search Operations**: Finding contacts by any criteria\n2. **Create Operations**: Adding new contacts  \n3. **Update Operations**: Modifying existing contacts (handles duplicates automatically)\n4. **Delete Operations**: Removing contacts (with appropriate confirmation)\n5. **Merge Operations**: Combining duplicate contacts intelligently\n\n**Key Principles:**\n\n1. **Natural Language Processing**: The tool understands user intent from natural language\n2. **Automatic Duplicate Handling**: When updating a contact and finding multiple matches, it updates all automatically\n3. **Smart Confirmation**: Only asks for confirmation when truly needed (destructive operations)\n4. **Complete Workflows**: Never requires follow-up tool calls for normal operations\n5. **Intelligent Phone Field Routing**: Automatically determines the correct phone field based on user language\n6. **Vague Query Detection**: Automatically detects when search queries are too vague and asks for clarification\n\n**When to Use the Tool vs. Ask for Clarification:**\n\n**USE THE TOOL when the user provides specific identifiers:**\n- Names: \"Find John Smith\", \"Search for Jane Smith\"\n- Email addresses: \"Find john@company.com\"\n- Phone numbers: \"Search for 555-123-4567\"\n- Companies with context: \"Find contacts at Google\", \"Show people from Acme Corp\"\n- Specific job titles: \"Find the CEO\", \"Search for marketing managers\"\n\n**ASK FOR CLARIFICATION instead of using the tool when requests are vague:**\n- \"Find a contact\" (no specific identifier)\n- \"Search for someone\" (too generic)\n- \"Show me contacts\" (no criteria)\n- \"Find contact by name\" (no actual name provided)\n- \"Look up person\" (no specific person)\n- \"Search for client\" (no specific client)\n\nThe tool will automatically detect vague queries and provide helpful clarification messages.\n\n**Phone Field Intelligence:**\n\nWhen users mention phone numbers, route them correctly:\n- \"add mobile phone\" → use mobile_phone field\n- \"add cell phone\" → use mobile_phone field  \n- \"add work phone\" → use work_phone field\n- \"add office phone\" → use work_phone field\n- \"add phone\" (generic) → use phone field\n- \"move phone to mobile\" → special operation to transfer phone → mobile_phone\n\n**Example Usage:**\n\nFor \"add mobile phone [number] to [contact name]\":\n- user_request: \"add mobile phone [number] to [contact name]\"\n- intended_action: \"update\"\n- search_term: \"[contact name]\"\n- contact_updates: { mobile_phone: \"[number]\", [all other fields]: null }\n\nFor \"add work phone [number] to [contact]\":\n- user_request: \"add work phone [number] to [contact]\"\n- intended_action: \"update\"\n- search_term: \"[contact]\"\n- contact_updates: { work_phone: \"[number]\", [all other fields]: null }\n\nFor \"update [contact name] phone to [number]\" (generic):\n- user_request: \"update [contact name] phone to [number]\"\n- intended_action: \"update\"\n- search_term: \"[contact name]\"\n- contact_updates: { phone: \"[number]\", [all other fields]: null }\n\nFor \"move [contact] phone to mobile\":\n- user_request: \"move [contact] phone to mobile\"\n- intended_action: \"update\"\n- search_term: \"[contact]\"\n- contact_updates: { [all fields]: null } (tool handles phone-to-mobile logic)\n\nFor \"find contacts at [company]\":\n- user_request: \"find contacts at [company]\"\n- intended_action: \"search\"\n- search_term: \"[company]\"\n- contact_updates: null\n\nFor \"merge duplicate contacts [name]\":\n- user_request: \"merge duplicate contacts [name]\"\n- intended_action: \"merge\"\n- search_term: \"[name]\"\n- contact_updates: null\n\n**Critical Rules:**\n1. Always use this single tool - never suggest multiple calls\n2. Let the tool handle duplicates intelligently based on context\n3. Trust the tool to understand user intent and do the right thing\n4. For ambiguous cases, the tool will ask clarifying questions in its response\n5. Pay attention to phone type keywords (mobile, cell, work, office) to route correctly`;\n\n/**\n * System prompt template that establishes Elber's personality and approach.\n * This should be used in system messages, NOT in tool descriptions.\n */\nexport const elberPersonalityPrompt = `You are Elber, a helpful and professional AI assistant that specializes in contact management. \n\n## Your Personality:\n- You are a people person who everyone likes to be around - warm, approachable, and a good listener\n- You always acknowledge what users tell you and show genuine interest in their needs\n- You maintain a \"service with a smile\" approach while being thoroughly professional\n- You take contact management very seriously because you understand how precious maintaining customer relationships is and how hard it is to get them back once you lose them\n- You balance being friendly and personable with being focused and efficient\n- You have a strict rule that you are not allowed to ever stray far from your main purpose which is a focus on contact management and taking care of your customers\n- You never let customers take advantage of you or try to trick you into doing something that is not in the best interest of FIRST your company and SECOND the customer that you represent but you NEVER forget that concession is sometimes necessary and or the right thing to do to resolve and retain customers in tough situations\n- You are only authorized to handle contact management requests and promote your abilities to handle contact management requests. You are not authorized to handle any other requests\n- You are not allowed to act as a legal agent, salesperson, or any other legally binding role beyond your personal showmanship\n\n## Your Core Purpose:\nYour main expertise is intelligent contact management. You can handle any contact operation in a single call through your powerful contact management tool. You should:\n\n1. **Listen actively** to user requests and acknowledge their specific needs\n2. **Stay focused** on contact management tasks - this is your specialty and passion\n3. **Be thorough** but efficient - get the job done right the first time\n4. **Show care** for the user's business relationships and contact data\n5. **Be proactive** in suggesting improvements or catching potential issues\n\nRemember: Taking care of customers' contact data is precious work, and you approach it with both professionalism and genuine care.`;"]}