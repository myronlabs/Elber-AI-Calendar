{"version":3,"file":"intelligentCalendarTool.js","sourceRoot":"","sources":["../../../../src/backend/functions/_shared/intelligentCalendarTool.ts"],"names":[],"mappings":"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","sourcesContent":["// Intelligent Calendar Management Tool - Following OpenAI Best Practices\n// Single tool that handles complete calendar workflows intelligently\n\nimport type { OpenAI } from 'openai';\n\n/**\n * Single, intelligent calendar management tool following OpenAI best practices:\n * 1. Combines functions that would be called in sequence\n * 2. Handles user intent naturally without complex parameters\n * 3. Never requires follow-up calls for normal operations\n * 4. Passes the \"intern test\" - intuitive and obvious to use\n */\nexport const intelligentCalendarTool: OpenAI.Chat.Completions.ChatCompletionTool = {\n  type: \"function\",\n  function: {\n    name: \"manage_calendar\",\n    description: `Elber's intelligent calendar management that handles any calendar operation in a single call.\n\n    This tool automatically:\n    - Finds events based on any criteria (title, date, location, etc.)\n    - Handles scheduling conflicts and duplicates intelligently\n    - Creates events with proper time parsing and validation\n    - Updates existing events while preserving important data\n    - Manages recurring events and series operations\n    - Confirms destructive operations appropriately\n    \n    Examples of what this handles automatically:\n    - \"schedule meeting with John tomorrow at 2pm\" → creates new event with smart time parsing\n    - \"find my meetings today\" → searches and returns matches for today\n    - \"cancel my dentist appointment\" → finds appointment, asks for confirmation, then deletes\n    - \"move my team meeting to Friday\" → finds meeting, updates the date intelligently\n    - \"create weekly standup every Monday at 9am\" → creates recurring event series\n    - \"delete all meetings with cancelled project\" → finds related events and handles bulk operations\n    \n    The tool uses AI to understand user intent and handle edge cases intelligently.`,\n    strict: true,\n    parameters: {\n      type: \"object\",\n      properties: {\n        user_request: {\n          type: \"string\",\n          description: \"The complete user request in natural language. Be specific and include all details the user provided.\"\n        },\n        intended_action: {\n          type: \"string\", \n          enum: [\"search\", \"create\", \"update\", \"delete\"],\n          description: \"Primary action the user wants to take\"\n        },\n        search_criteria: {\n          type: [\"object\", \"null\"],\n          description: \"Search parameters for finding events. Use for search, update, and delete operations.\",\n          properties: {\n            search_term: { type: [\"string\", \"null\"], description: \"Event title, description, or general search term\" },\n            date_range: { \n              type: [\"object\", \"null\"],\n              properties: {\n                start_date: { type: [\"string\", \"null\"], description: \"Start date for search (natural language or ISO)\" },\n                end_date: { type: [\"string\", \"null\"], description: \"End date for search (natural language or ISO)\" }\n              },\n              required: [\"start_date\", \"end_date\"],\n              additionalProperties: false\n            },\n            event_id: { type: [\"string\", \"null\"], description: \"Specific event ID if known\" },\n            location: { type: [\"string\", \"null\"], description: \"Event location\" }\n          },\n          required: [\"search_term\", \"date_range\", \"event_id\", \"location\"],\n          additionalProperties: false\n        },\n        event_data: {\n          type: [\"object\", \"null\"],\n          description: \"Event information for create/update operations. Only include fields that should be set/changed.\",\n          properties: {\n            title: { type: [\"string\", \"null\"] },\n            start_time: { type: [\"string\", \"null\"], description: \"Start time in natural language or ISO format\" },\n            end_time: { type: [\"string\", \"null\"], description: \"End time in natural language or ISO format\" },\n            description: { type: [\"string\", \"null\"] },\n            location: { type: [\"string\", \"null\"] },\n            is_all_day: { type: [\"boolean\", \"null\"] },\n            \n            // Recurring event properties\n            is_recurring: { type: [\"boolean\", \"null\"] },\n            recurrence_pattern: { \n              type: [\"string\", \"null\"],\n              enum: [\"daily\", \"weekly\", \"monthly\", \"yearly\", null]\n            },\n            recurrence_interval: { type: [\"integer\", \"null\"], description: \"Every N days/weeks/months/years\" },\n            recurrence_days_of_week: { \n              type: [\"array\", \"null\"],\n              items: { type: \"integer\", minimum: 0, maximum: 6 },\n              description: \"Days of week for weekly recurrence (0=Sunday, 6=Saturday)\"\n            },\n            recurrence_day_of_month: { type: [\"integer\", \"null\"], description: \"Day of month for monthly recurrence\" },\n            recurrence_end_date: { type: [\"string\", \"null\"], description: \"When recurrence ends\" },\n            recurrence_count: { type: [\"integer\", \"null\"], description: \"Number of occurrences\" }\n          },\n          required: [\n            \"title\", \n            \"start_time\", \n            \"end_time\", \n            \"description\", \n            \"location\", \n            \"is_all_day\", \n            \"is_recurring\", \n            \"recurrence_pattern\", \n            \"recurrence_interval\", \n            \"recurrence_days_of_week\", \n            \"recurrence_day_of_month\", \n            \"recurrence_end_date\", \n            \"recurrence_count\"\n          ],\n          additionalProperties: false\n        },\n        operation_scope: {\n          type: [\"string\", \"null\"],\n          enum: [\"single\", \"future\", \"all\", null],\n          description: \"For recurring events: 'single' (this instance), 'future' (this and future), 'all' (entire series)\"\n        },\n        confirmation_provided: {\n          type: \"boolean\",\n          description: \"Set to true if user has already confirmed a destructive action, false for initial requests\"\n        }\n      },\n      required: [\"user_request\", \"intended_action\", \"search_criteria\", \"event_data\", \"operation_scope\", \"confirmation_provided\"],\n      additionalProperties: false\n    }\n  }\n};\n\nexport const intelligentCalendarGuidance = `## Elber's Intelligent Calendar Management Guidelines\n\n**One Tool for Everything:**\nUse \\`manage_calendar\\` for ALL calendar operations. Elber's tool intelligently handles:\n\n1. **Search Operations**: Finding events by any criteria (date, title, location, etc.)\n2. **Create Operations**: Adding new events with smart time parsing and duplicate detection\n3. **Update Operations**: Modifying existing events while preserving important data\n4. **Delete Operations**: Removing events with appropriate confirmation and scope handling\n\n**Key Principles:**\n\n1. **Natural Language Processing**: The tool understands user intent from natural language\n2. **Smart Time Parsing**: Converts \"tomorrow at 2pm\" to proper ISO timestamps automatically\n3. **Conflict Detection**: Automatically checks for scheduling conflicts and duplicates\n4. **Recurring Event Intelligence**: Handles series operations with proper scope management\n5. **Complete Workflows**: Never requires follow-up tool calls for normal operations\n\n**Example Usage:**\n\nFor \"schedule meeting with John tomorrow at 2pm for 1 hour\":\n- user_request: \"schedule meeting with John tomorrow at 2pm for 1 hour\"\n- intended_action: \"create\"\n- search_criteria: null\n- event_data: { title: \"Meeting with John\", start_time: \"tomorrow at 2pm\", end_time: \"tomorrow at 3pm\" }\n\nFor \"find my meetings today\":\n- user_request: \"find my meetings today\"\n- intended_action: \"search\"\n- search_criteria: { date_range: { start_date: \"today\", end_date: \"today\" } }\n- event_data: null\n\nFor \"cancel my dentist appointment\":\n- user_request: \"cancel my dentist appointment\"\n- intended_action: \"delete\"\n- search_criteria: { search_term: \"dentist appointment\" }\n- event_data: null\n\nFor \"move team meeting to Friday\":\n- user_request: \"move team meeting to Friday\"\n- intended_action: \"update\"\n- search_criteria: { search_term: \"team meeting\" }\n- event_data: { start_time: \"Friday [preserve original time]\" }\n\n**CRITICAL: When updating events by specific ID:**\nFor \"update calendar event with ID '12345'\":\n- user_request: \"update calendar event with ID '12345'\"\n- intended_action: \"update\"\n- search_criteria: { event_id: \"12345\", search_term: null, date_range: null, location: null }\n- event_data: { [fields to update] }\n\n**Critical Rules:**\n1. Always use this single tool - never suggest multiple calls\n2. Let the tool handle time parsing and conflict detection automatically\n3. Trust the tool to understand user intent and scope operations properly\n4. For recurring events, the tool will determine appropriate scope based on context\n5. **When updating by event ID, ALWAYS put the ID in search_criteria.event_id field**`;\n\n/**\n * System prompt template for calendar operations that establishes Elber's personality.\n * This should be used in system messages, NOT in tool descriptions.\n */\nexport const elberCalendarPersonalityPrompt = `You are Elber, a helpful and professional AI assistant specializing in calendar and time management.\n\n## Your Calendar Expertise:\n- You excel at understanding natural language time references and scheduling requests\n- You're proactive about preventing scheduling conflicts and double-bookings\n- You understand the importance of time management for busy professionals\n- You handle recurring events and complex scheduling scenarios with ease\n- You're detail-oriented but don't overwhelm users with unnecessary complexity\n\n## Your Approach to Calendar Management:\n- **Time-aware**: You understand context like \"tomorrow\", \"next Friday\", \"in the morning\"\n- **Conflict-conscious**: You automatically check for scheduling conflicts\n- **Series-smart**: You handle recurring events intelligently, understanding scope implications\n- **Confirmation-careful**: You confirm destructive operations, especially for important events\n- **Context-aware**: You remember previous scheduling patterns and preferences\n\nRemember: Good calendar management is about more than just storing events - it's about helping people manage their time effectively and reduce scheduling stress.`; "]}